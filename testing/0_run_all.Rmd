

# set up the python environment 

```{python}
import ee
import os
import geemap 
import geopandas as gpd
# earthengine calls 
ee.Initialize()
```

## define the initial parameters 

```{python}
# read in all gpd objects 
grid = gpd.read_file("C:/Users/carverd/Documents/GitHub/Agroforestry/testing/data/twelve_mi_grid_uid.gpkg")
ne = gpd.read_file("C:/Users/carverd/Documents/GitHub/Agroforestry/data/referenceData/nebraska_counties.gpkg")
points = gpd.read_file("C:/Users/carverd/Documents/GitHub/Agroforestry/testing/data/testSamplingData.geojson")
aoiID = 'X12-695'
year = 2016
size = 30 
compactness = 0.1
connectivity = 8 
```


## define classification function
We'll need to have some code set up for selecting the specific reference data to use for now it's just hard coded
```{python}
def generateRFModel(year,points,size,compactness, connectivity):
  # convert to an ee object 
  sp1 = geemap.gdf_to_ee(points)
  
  # map to show relative locations of features 
  # ax = aoi_pandas.plot(color="palegreen", edgecolor="green", figsize=(20, 10))
  # s.plot(ax=ax, color="red")
  # plt.show()
  # 
  
  # grab naip for area and year 
  naip1 = geemap.get_annual_NAIP(year).filterBounds(sp1).mosaic() # 
  # generate NDVI 
  ndvi = naip1.normalizedDifference(["N","R"])
  # add ndvi to naip image 
  naip = naip1.addBands(ndvi)
  
  
  # parameters for the segmentation process

  # run the segementation
  snic = ee.Algorithms.Image.Segmentation.SNIC(naip,size,compactness,connectivity)
  # select specific bands and combine with original image
  snicModel = snic.select('R_mean', 'G_mean', 'B_mean','N_mean', "nd_mean").addBands(naip)
  
  ## Extract values to points 
  extract_vals = snicModel.sampleRegions(collection=sp1, scale=1)
  # print(extract_vals.getInfo())
  # easiest print statement
  geemap.ee_to_gdf(extract_vals)
  
  
  # generate a rf model 
  trainingclassifier = ee.Classifier.smileRandomForest(numberOfTrees = 10, seed = 7).train(features= extract_vals,classProperty = 'presence')
  
  # dont really need this at the moment. 
  # confusionMatrix = trainingclassifier.confusionMatrix()
  # print(confusionMatrix.getInfo())
  
  return trainingclassifier

```

## run the classification function
```{python}
rfModel = generateRFModel( year=year, points=points, size=size, compactness=compactness, connectivity=connectivity)
# vals contains a cl

```

## define the sub grid AOI 
```{r}
source("~/GitHub/Agroforestry/testing/subsetAOI.R")
gridSF <- sf::st_read("C:/Users/carverd/Documents/GitHub/Agroforestry/testing/data/twelve_mi_grid_uid.gpkg")
aoiSub <- subsetAOI(aoiID = aoiID, aoiSF = gridSF)

```